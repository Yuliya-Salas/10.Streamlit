import streamlit as st
import pandas as pd
import plotly.express as px
import json

st.set_page_config(
    page_title='Bananas',
    page_icon='üçå',
    layout="wide",
    initial_sidebar_state="auto",
)

st.title('–≠–∫—Å–ø–æ—Ä—Ç –±–∞–Ω–∞–Ω–æ–≤')
st.write('''–ë–∞–Ω–∞–Ω—ã ‚Äî –æ–¥–Ω–∞ –∏–∑ –¥—Ä–µ–≤–Ω–µ–π—à–∏—Ö –ø–∏—â–µ–≤—ã—Ö –∫—É–ª—å—Ç—É—Ä, –∞ –¥–ª—è —Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä–∞–Ω ‚Äî –≤–∞–∂–Ω–µ–π—à–µ–µ –ø–∏—â–µ–≤–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ –∏ –≥–ª–∞–≤–Ω–∞—è —Å—Ç–∞—Ç—å—è —ç–∫—Å–ø–æ—Ä—Ç–∞. 
         –°–ø–µ–ª—ã–µ –±–∞–Ω–∞–Ω—ã —à–∏—Ä–æ–∫–æ —É–ø–æ—Ç—Ä–µ–±–ª—è—é—Ç—Å—è –≤ –ø–∏—â—É –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É, –∏—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–∏ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–ª—é–¥''')
st.write('–ù–∞ –∫–∞—Ä—Ç–µ –ø–æ–∫–∞–∑–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ–± –æ–±—ä–µ–º–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –±–∞–Ω–∞–Ω–æ–≤ —Å 1960–≥ –ø–æ 2021–≥ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º –≤ —Ç–æ–Ω–Ω–∞—Ö')
st.write('''–ö–∞–∫ –≤–∏–¥–Ω–æ –∏–∑ —Ç–∞–±–ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–∞ –∫–∞—Ä—Ç–µ - —Å –∫–∞–∂–¥—ã–º –≥–æ–¥–æ–º —Å–ø—Ä–æ—Å –Ω–∞ –±–∞–Ω–∞–Ω—ã —Ä–∞—Å—Ç–µ—Ç. 
         –û–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –∞—Ñ—Ä–∏–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 40 –ª–µ—Ç —É–≤–µ–ª–∏—á–∏–ª–∞ –æ–±—ä–µ–º —ç–∫—Å–ø–æ—Ä—Ç–∞ –±–æ–ª–µ–µ —á–µ–º –≤ 7 —Ä–∞–∑. 
         –ù–∏–∂–µ, –Ω–∞ –∫–∞—Ä—Ç–µ, –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞–∫ –º–µ–Ω—è–ª—Å—è –æ–±—å–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –±–∞–Ω–∞–Ω–æ–≤ –≤–æ –≤—Å–µ–º –º–∏—Ä–µ''')


DATA = 'banana-production.csv'
DATE_COLUMN = 'Year'

def load_data():
    df = pd.read_csv(DATA, parse_dates=[DATE_COLUMN], delimiter=',')
    df[DATE_COLUMN] = df[DATE_COLUMN].dt.strftime('%Y')  # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≥–æ–¥ –∫ —Å—Ç—Ä–æ–∫–æ–≤–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É, –ø—Ä–æ–±—É–µ–º –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É –ø—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏
    return df

df = load_data()

with open('countries.geo.json') as json_file:
    json_locations = json.load(json_file)

def draw_map_cases():
    fig = px.choropleth_mapbox(
        df,
        geojson=json_locations,
        locations='Code',
        color='Bananas',
        color_continuous_scale='brwnyl',
        mapbox_style='carto-positron',
        title='–û–±—ä–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –±–∞–Ω–∞–Ω–æ–≤, –≤ —Ç–æ–Ω–Ω–∞—Ö',
        zoom=1,
        opacity=0.5,
        animation_frame='Year'  # –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ –≥–æ–¥–∞–º
    )
    fig.update_layout(margin={'r': 0, 't': 0, 'l': 0, 'b': 0})
    return fig

st.plotly_chart(draw_map_cases())

show_data = st.sidebar.checkbox('–ü–æ–∫–∞–∑–∞—Ç—å –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ–±—ä–µ–º–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –±–∞–Ω–∞–Ω–æ–≤')
if show_data:
    st.subheader('–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ')
    st.markdown("#### –î–∞–Ω–Ω—ã–µ –æ–± –æ–±—ä–µ–º–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –±–∞–Ω–∞–Ω–æ–≤ —Å 1960–≥ –ø–æ 2021–≥ [–∑–¥–µ—Å—å](https://www.kaggle.com/datasets/whenamancodes/banana-production-minion-loves-banana).")
    st.write(df)

